/* css/desktop.css */

/* ==========================================================================
   SECTION 1: CORE STYLES & VARIABLES
   ========================================================================== */
@import url('https://fonts.googleapis.com/css2?family=Balsamiq+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Comfortaa:wght@300..700&family=Fredoka:wght@300..700&family=Fredoka+One&family=Itim&family=Jua&family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Sniglet:wght@400;800&family=Varela+Round&display=swap');

:root {
    --bg-color: #ffffff;
    --panel-bg: #f4f4f4;
    --text-color: #ffffff;
    --accent-blue: #4facfe;
    --accent-orange: #f39c12;
    --accent-purple: #9b59b6;
    --accent-red: #e74c3c;
    --accent-green: #2ecc71;
    --locked-color: #bdc3c7;
    --line-color: #000000;
    --tree-bg: #ffffff;
    --node-bg-locked: #ecf0f1;
    --node-border-locked: #bdc3c7;
    --node-bg-unlocked: #cbaac3;
    --node-border-unlocked: #a67c52;
    --pipe-color: #000000;
    --font-main: 'Fredoka One', sans-serif; 
    --base-size: 16px; 
}

html {
    font-size: var(--base-size); 
    -webkit-text-size-adjust: 100%; 
    text-size-adjust: 100%;
}

body {
    font-family: var(--font-main);
    font-weight: 700;
    color: var(--text-color);
    -webkit-text-stroke: 2.5px #000000; 
    letter-spacing: 1px;
    paint-order: stroke fill;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    background-color: var(--bg-color); 
    margin: 0; 
    height: 100vh; 
    height: 100dvh; 
    display: flex; 
    flex-direction: column; 
    overflow: hidden; 
    user-select: none;
}

@media (min-width: 769px) {
    .mobile-only { display: none !important; }
    .desktop-only { display: flex !important; }
    body { overflow: hidden; }

    /* 1. THE GLOBAL DESK BACKGROUND */
    .desktop-workspace { 
        display: flex; gap: 20px; height: 100vh; width: 100vw; padding: 20px; 
        background-color: #dbe4eb; box-sizing: border-box;
    }
    
    /* 3. WORKSPACE WRAPPER (Transparent Container) */
    .workspace-card {
        flex: 1; min-width: 0; 
        display: flex; 
        background: transparent; border: none; box-shadow: none;
        gap: 25px; 
        overflow: visible !important; 
        margin-top: 25px; 
    }

    /* 4. LEFT PANE (TREE) */
    .pane.left-pane { 
        flex: 1; width: 50%; 
        height: 100%; 
        display: flex; flex-direction: column; 
        border: 4px solid #2d3436; border-radius: 24px;
        box-shadow: 8px 8px 0px rgba(0,0,0,0.15);
        background-color: #ffffff;
        background-image: radial-gradient(#cbd5e1 1.5px, transparent 1.5px);
        background-size: 24px 24px;
        overflow: visible !important; position: relative;
        box-sizing: border-box; 
    }

    /* 5. RIGHT PANE WRAPPER (Anchor for Floating Elements) */
    .pane.right-pane-wrapper { 
        flex: 1; width: 50%; height: 100%;
        display: flex; flex-direction: column;
        position: relative; /* Anchors the floating header/buttons */
        overflow: visible !important; /* Allows header/buttons to stick out */
        box-sizing: border-box;
        border: none; background: transparent; box-shadow: none; 
    }

    /* 2. RIGHT PANE VISUAL (Actual Card Content with Clipping) */
    .pane-visual {
        width: 100%; height: 100%;
        display: flex; flex-direction: column;
        background: #fdfdfd; 
        border: 4px solid #2d3436; 
        border-radius: 24px;
        box-shadow: 8px 8px 0px rgba(0,0,0,0.15);
        overflow: hidden; /* THIS FIXES THE CORNER CLIPPING */
        box-sizing: border-box;
        padding-top: 20px; /* Space for the floating header */
    }

    /* HEADER ROWS (Force Center) */
    .pane.left-pane .d-header-row,
    .row-controls {
        display: flex !important; flex-direction: row !important;
        justify-content: center !important; align-items: center !important;
        width: 100% !important; box-sizing: border-box;
    }
}


/* ==========================================================================
   SECTION 2: SCROLLBARS
   ========================================================================== */
::-webkit-scrollbar { width: 10px; }
::-webkit-scrollbar-track { background: var(--bg-color); }
::-webkit-scrollbar-thumb { background: #bdc3c7; border-radius: 5px; border: 2px solid var(--bg-color); }
::-webkit-scrollbar-thumb:hover { background: #95a5a6; }

/* MODERN SLIM SCROLLBARS (ENABLED) */
/* 1. ENABLE SCROLLING on key containers */
.tree-container,
.dashboard-scroll-wrapper, 
.modal-body-scroll,
.sidebar-scroll-wrapper,
.more-menu {
    /* Allow scrolling in both directions if content overflows */
    overflow-y: auto !important;
    overflow-x: auto !important; 

    /* Firefox: Slim Scrollbar */
    scrollbar-width: thin !important;
    scrollbar-color: #bdc3c7 transparent !important;
}

/* 2. WEBKIT STYLING (Chrome, Edge, Safari, Opera) */
/* Set size for Vertical (width) and Horizontal (height) bars */
::-webkit-scrollbar {
    width: 8px !important;  /* Slim vertical bar */
    height: 8px !important; /* Slim horizontal bar */
}

/* The Background Track (Invisible/Subtle) */
::-webkit-scrollbar-track {
    background: transparent !important; 
    border-radius: 4px;
    margin: 4px 0; /* Tiny margin at ends */
}

/* The Moving "Thumb" (Handle) */
::-webkit-scrollbar-thumb {
    background-color: #bdc3c7 !important; /* Matches your 'locked' grey color */
    border-radius: 4px !important;        /* Fully rounded */
    
    /* This creates a 'floating' look by adding transparent border padding */
    border: 2px solid transparent !important; 
    background-clip: content-box !important;
}

/* Hover Effect */
::-webkit-scrollbar-thumb:hover {
    background-color: #7f8c8d !important; /* Darker grey when grabbing */
    border: 1px solid transparent !important; /* Gets slightly thicker on hover */
}

/* The Corner (where X and Y bars meet) */
::-webkit-scrollbar-corner {
    background: transparent !important;
}


/* ==========================================================================
   SECTION 3: MAIN WORKSPACE LAYOUT & DASHBOARD
   ========================================================================== */

/* --- A. DESKTOP LAYOUT (Strictly for screens > 768px) --- */
@media (min-width: 769px) {
    .mobile-only { display: none !important; }
    .desktop-only { display: flex !important; }
    body { overflow: hidden; }

    /* 1. THE GLOBAL DESK BACKGROUND */
    .desktop-workspace { 
        display: flex; gap: 20px; height: 100vh; width: 100vw; padding: 20px; 
        background-color: #dbe4eb; box-sizing: border-box;
    }
    
    /* 2. DASHBOARD PANE (Layout Logic Only) */
    .dashboard-pane { 
        position: relative !important;
        overflow: visible !important; /* REQUIRED for Doraemon Header */
        height: calc(100vh - 75px) !important; 
        margin-top: 25px !important;
        
        /* WIDTH LOGIC: Flexible 25% width with Min/Max limits */
        flex: 0 0 25vw !important; 
        width: 25vw !important;
        max-width: 260px !important; 
        min-width: 160px !important; 

        display: flex !important; 
        flex-direction: column !important;
        align-items: stretch !important;
        
        background: #ffffff; 
        border: 4px solid #2d3436 !important; 
        border-radius: 24px !important;       
        box-shadow: 8px 8px 0px rgba(0,0,0,0.15); 
        padding: 0 !important; /* Internal padding handled by wrapper */
        z-index: 100;
    }

    /* 3. WORKSPACE WRAPPER (Transparent Container) */
    .workspace-card {
        flex: 1; min-width: 0; 
        display: flex; 
        background: transparent; border: none; box-shadow: none;
        gap: 25px; 
        overflow: visible !important; 
        margin-top: 25px; 
    }

    /* 4. LEFT PANE (TREE) */
    .pane.left-pane { 
        flex: 1; width: 50%; 
        height: 100%; 
        display: flex; flex-direction: column; 
        border: 4px solid #2d3436; border-radius: 24px;
        box-shadow: 8px 8px 0px rgba(0,0,0,0.15);
        background-color: #ffffff;
        background-image: radial-gradient(#cbd5e1 1.5px, transparent 1.5px);
        background-size: 24px 24px;
        overflow: visible !important; position: relative;
        box-sizing: border-box; 
    }

    /* 5. RIGHT PANE WRAPPER (Anchor for Floating Elements) */
    .pane.right-pane-wrapper { 
        flex: 1; width: 50%; height: 100%;
        display: flex; flex-direction: column;
        position: relative; 
        overflow: visible !important; 
        box-sizing: border-box;
        border: none; background: transparent; box-shadow: none; 
    }

    /* 6. RIGHT PANE VISUAL (Actual Card Content) */
    .pane-visual {
        width: 100%; height: 100%;
        display: flex; flex-direction: column;
        background: #fdfdfd; 
        border: 4px solid #2d3436; 
        border-radius: 24px;
        box-shadow: 8px 8px 0px rgba(0,0,0,0.15);
        overflow: hidden; 
        box-sizing: border-box;
        padding-top: 20px; 
    }

    /* 7. HEADER ROWS (Force Center) */
    .pane.left-pane .d-header-row,
    .row-controls {
        display: flex !important; flex-direction: row !important;
        justify-content: center !important; align-items: center !important;
        width: 100% !important; box-sizing: border-box;
    }
} 
/* --- END OF DESKTOP MEDIA QUERY --- */


/* --- B. DASHBOARD STYLING (Colors & Buttons) --- */

/* 1. SHARED THEME (Minty Ice Background) */
/* This controls the color for BOTH the Save/Load box and the Tools box */
.tools-group-box,
.dashboard-capsule {
    border: 2px solid #000000 !important;
    border-radius: 16px !important;
    box-sizing: border-box !important;
    margin-bottom: 15px !important;
}

/* 2. DASHBOARD CAPSULE (Specific Layout) */
.dashboard-capsule {
    background-color: #ffffff !important;
    width: 100% !important;
    display: flex !important;
    justify-content: space-between !important; 
    gap: 10px !important; 
    padding: 12px !important; 
    height: auto !important;
    
    /* Pop-out Shadow */
    box-shadow: 0 4px 6px rgba(0,0,0,0.15) !important;
    position: static !important; 
}

/* 3. TOOLS BOX (Specific Layout) */
.tools-group-box {
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    background-color:#F4F9FD !important;
    /* Sunken Shadow (Inset) */
    box-shadow: inset 0 4px 6px rgba(0,0,0,0.1) !important;
    margin-bottom: 0 !important;
}

/* 4. SCROLL WRAPPER */
.dashboard-scroll-wrapper {
    flex: 1;                     
    overflow-y: auto;            
    width: 100%;
    padding-top: 40px;           
    padding-bottom: 20px; 
    padding-left: 15px;
    padding-right: 15px;
    box-sizing: border-box;
}

/* 5. BUTTON STYLING (Save/Load/Help) */
.sys-btn {
    flex: 1 !important; 
    width: auto !important; 
    height: 55px !important; 
    
    /* THE GAME BLUE STYLE */
    background-color: #c0eafa !important; 
    border: 2px solid #000000 !important;
    border-radius: 12px !important; 
    
    /* The "Inset" 3D Shadow (Darker Blue) */
    box-shadow: inset 0 -6px 0 0 #70abc0, 0 4px 5px rgba(0,0,0,0.2) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    cursor: pointer !important;
    margin: 0 !important;
    padding: 0 !important;
    transition: transform 0.1s;
}

.sys-btn:active {
    transform: translateY(3px) !important;
    /* Shadow shrinks to look pressed */
    box-shadow: inset 0 -2px 0 0 #005d96, 0 1px 2px rgba(0,0,0,0.2) !important;
}

.sys-icon {
    width: 28px !important; 
    height: 28px !important;
    object-fit: contain;
     transform: translateY(-4px) !important;
    /* Tiny shadow for icon depth */
    filter: drop-shadow(0 2px 0 rgba(0,0,0,0.2)); 
}

/* 6. TOOL BUTTON STYLING (Schedule, Stats, etc.) */
.tools-group-box .dash-btn {
    width: 100% !important;
    height: 45px !important;
    margin-bottom: 0 !important;
    
    font-family: 'Fredoka One', sans-serif !important; 
    font-size: 1rem !important;
    color: #ffffff !important;          
    -webkit-text-stroke: 2.5px #000000; 
    paint-order: stroke fill;           

    background: #ffffff !important;
    border: 2px solid #000000 !important;
    border-radius: 10px !important;
    box-shadow: 0 4px 0 rgba(0,0,0,0.15) !important;
    transition: transform 0.1s;
    cursor: pointer;
    
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
    
    display: flex !important;
    align-items: center !important;
    justify-content: flex-start !important; 
    padding-left: 15px !important;          
}

.tools-group-box .dash-btn:active {
    transform: translateY(2px) !important;
    box-shadow: 0 2px 0 rgba(0,0,0,0.15) !important;
}

.dash-icon {
    width: 35px;
    height: 35px;
    object-fit: contain;
    margin-right: 5px;
    filter: drop-shadow(0 1px 1px rgba(0,0,0,0.2));
}

/* ==========================================================================
   SECTION 4: HEADER SYSTEM (Top Mode Switch, Tree Selectors, Floating Header)
   ========================================================================== */

/* --- A. New Header Styles (v4: Height Match & 2px) --- */
/* 1. The Main Flex Container */
.new-header-container {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    justify-content: center !important; /* Centered on Canvas */
    gap: 15px !important; 
    width: 100%;
    padding: 0 20px;
    margin-top: -24px;
    z-index: 100;
    position: relative;
    box-sizing: border-box;
}

/* 2. The Mode Switch (Setup/Plan) */
.new-mode-switch {
    display: flex !important;
    align-items: center !important;
    background-color: #34495e; 
    border: 2px solid #000000 !important; 
    border-radius: 12px;
    height: 36px !important; /* Base height (inactive state) */
    width: 220px !important; 
    flex: 0 0 220px !important; 
    padding: 0;
    overflow: visible !important; /* Allows the active button to pop out */
    position: relative;
    z-index: 10;
    box-sizing: border-box;
}

/* Internal divider for the switch */
.new-mode-switch .seg-btn {
    border-right: 2px solid #000000 !important; 
}
.new-mode-switch .seg-btn:last-child {
    border-right: none !important;
}

/* FIX: Ensure the active pop-out uses 2px border too */
.seg-btn.active::before {
    border-width: 2px !important;
    /* Ensure pop-out matches the new capsule height visually */
    height: 140% !important; 
}

/* 3. The Tools Cluster */
.new-tools-cluster {
    display: flex !important;
    align-items: center !important;
    justify-content: flex-start !important;
    flex: 0 0 auto !important; 
    height: 44px !important; /* Match the new Capsule Height */
}

/* 4. The Capsule Itself */
.control-capsule {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px; 
    height: 44px !important;
    background-color: #ecf0f1; 
    border: 2px solid #000000 !important; 
    border-radius: 12px;
    padding: 0 6px; 
    box-sizing: border-box;
}

/* 5. Buttons Inside Capsule */
.control-capsule button {
    /* Make buttons fill the vertical space minus padding */
    height: 34px !important; 
    width: 34px !important;  
    border-radius: 8px !important;
    border-width: 2px !important; 
    border-color: #000000 !important;
    border-style: solid !important;
    margin: 0 !important;
    padding: 0 !important;
    min-width: 0 !important; 
    box-sizing: border-box;
}


/* --- B. Tree Selector (Forge/SPT/Power) --- */
/* High Specificity Selector to override the "Left Align" default */
.pane.left-pane .d-header-row.row-tabs {
    display: flex !important;
    flex-direction: row !important;
    justify-content: center !important; 
    width: 100% !important;
    padding: 0 20px;
    box-sizing: border-box;
    margin-top: 10px !important;
}

/* Ensure the button container itself doesn't have weird margins */
.pane.left-pane .d-header-row.row-tabs .segmented-control {
    margin: 0 !important;
}

/* FIX: PREVENT BUTTON OVERLAP ON SCROLL */
/* 1. Ensure the top row (Setup/Plan) stays physically behind the second row (Forge/SPT) */
.new-header-container {
    z-index: 10 !important;
}

.pane.left-pane .d-header-row.row-tabs {
    z-index: 20 !important; /* Higher than the container above it */
    position: relative;
    background-color: #ffffff; /* Gives the row a solid floor so the pop-out hides behind it */
    padding-top: 5px !important;
    margin-top: 15px !important; /* Adds a tiny cushion so they don't touch */
}

/* 2. Shrink the 'Pop-out' slightly so it isn't so aggressive on the vertical axis */
.new-mode-switch .seg-btn.active::before {
    height: 120% !important; /* Reduced from 140% to prevent clashing */
}


/* --- C. Floating Header (Circle + Pill) --- */
/* 1. Put the container back to dead center */
.floating-header-container {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translate(-50%, -50%) !important; 
    z-index: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
}

/* 2. Force the Circle to the Front */
.fhc-pill {
    /* SIZE & POSITION */
    min-width: 0 !important; 
    width: auto !important;
    height: 40px !important;
    display: flex !important; 
    align-items: center !important;
    z-index: 5 !important; /* Stays strictly under the circle */
    
    /* SHAPE FIX: Destroys the left "half-circle" so it is completely flat */
    border-radius: 0 20px 20px 0 !important; 
    
    /* BORDER & COLOR */
    background: rgb(235, 242, 250) !important;
    border: 2px solid #000000 !important;
    border-left: none !important; /* Kills the double line where they meet */
    box-shadow: 4px 4px 0 rgba(0,0,0,0.1) !important;
    
    /* SPACING & TUCK */
    padding-left: 20px !important;
    padding-right: 45px !important; 
    margin-left: -18px !important; /* Pulls the flat edge tightly under the circle */
}

/* Force the main circle to stay on top of the flat edge */
.fhc-circle {
    position: relative !important;
    z-index: 10 !important;
}
.fhc-pill span {
    font-family: 'Fredoka One', cursive;
    font-size: 1.1rem;
    color: #ffffff;
    -webkit-text-stroke: 3px #000000;
    paint-order: stroke fill;
    margin-top: -2px;
    margin-left: 5px; 
}

/* Styling for the custom image banner inside the pill */
.pill-banner {
    height: 24px; 
    width: auto;  
    object-fit: contain;
    margin-left: 0px; 
    margin-top: -2px; 
    display: block;
}

.fhc-pill.main-banner-pill {
    background-color: #dbe4eb;
    padding-right: 15px !important; 
}

/* FIX: This makes the span fill the circle perfectly to center the image */
.fhc-circle span {
    display: flex;
    width: 100%;
    height: 100%;
    justify-content: center;
    align-items: center;
    margin: 0;
}

.fhc-circle img {
    width: 80% !important;
    height: 80% !important;
    object-fit: contain;
    display: block;
}

/* ==========================================================================
   SECTION 5: INSTANT FONT SNAP & BUTTONS (Legacy & Mobile)
   ========================================================================== */
/* GENERIC Segmented Control (For Tree Tabs) */
.segmented-control {
    background-color: #34495e; 
    border: 1.5px solid #000000; 
    border-radius: 12px;
    display: flex;
    align-items: center; 
    width: 90%; /* Default wide width */
    max-width: 450px;
    margin: 15px auto; 
    padding: 0;
    position: relative;
    z-index: 1;
    box-sizing: border-box;
    height: 32px; 
    box-shadow: none; 
}

/* === CRITICAL FIX: SPECIFIC OVERRIDE FOR SETUP/PLAN SWITCH === */
div.segmented-control.nav-mode {
    margin: 0 !important;   
    width: auto !important; /* Force it to shrink to content */
    max-width: 300px !important;
    min-width: 200px !important;
    height: 36px !important;
    flex: 0 0 auto !important; /* Do NOT grow */
}

@media (max-width: 768px) {
    .segmented-control.nav-mode {
        width: 100% !important;
        max-width: none !important;
        height: 34px;
    }
}

/* --- THE BUTTON (STRUCTURAL) --- */
.seg-btn {
    flex: 1; 
    height: 100%;
    position: relative; 
    background: transparent;
    border: none;
    border-right: 1.5px solid #000000; 
    margin: 0;
    color: #ffffff;
    font-family: 'Fredoka One', 'Fredoka', sans-serif;
    font-size: 0.9rem; 
    letter-spacing: 0.5px;
    cursor: pointer;
    -webkit-text-stroke: 2px #000000; 
    paint-order: stroke fill;
    text-shadow: none;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1;
    transition: transform 0.1s ease; 
}

.seg-btn:last-child { border-right: none; }

.seg-btn.active {
    z-index: 50; 
    border-right-color: transparent; 
    color: #ffffff;
    font-size: 1.15rem; 
}

.seg-btn.active::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 110%;  
    height: 170%; 
    background: #00b0ff;
    border: 2px solid #000000;
    border-radius: 10px;
    box-shadow: inset 0 -6px 0 0 #005680, 0 4px 6px rgba(0,0,0,0.3);
    z-index: -1; 
}

/* === CAPSULE PLACEMENT === */
.action-cluster {
    display: flex !important;
    justify-content: flex-start !important;
    align-items: center !important;
    padding: 0 !important;
    margin-left: 10px !important; /* Small gap between switch and capsule */
    flex: 0 0 auto !important; /* Do not grow */
}

/* THE CAPSULE CONTAINER (Old/Mobile Style) */
.control-capsule {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px; 
    height: 36px;
    background-color: #ecf0f1; 
    border: 2px solid #000000; 
    border-radius: 12px;
    padding: 0 4px;
    box-sizing: border-box;
}

/* 3D SQUARE BUTTONS (Inside Capsule & General) */
#btn-undo-desktop, #btn-undo-log, #btn-undo-mobile-new, #btn-undo-egg,
#btn-redo-desktop, #btn-redo-log, #btn-redo-mobile-new, #btn-redo-egg,
.btn-reset-text, .tree-reset-btn, .tn-action-btn.reset-neutral,
button[onclick="clearPlan()"], button[onclick="clearEggPlan()"] { 
    width: 36px;
    height: 36px;
    border-radius: 10px;
    /* CHANGE: Global 3px thickness */
    border: 3px solid #000000; 
    padding: 0;
    margin: 0 2px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    position: relative; 
    color: transparent; 
    font-size: 0;
    cursor: pointer;
    background-image: none; 
    box-sizing: border-box; /* ADD THIS: Helps maintain size with thicker borders */
}

/* SHRINK BUTTONS ONLY WHEN INSIDE CAPSULE */
.control-capsule button {
    width: 26px !important;  
    height: 26px !important; 
    border-radius: 6px !important;
    border-width: 2px !important;
    margin: 0 !important;
}

/* ICONS */
#btn-undo-desktop::after, #btn-undo-log::after, #btn-undo-mobile-new::after, #btn-undo-egg::after,
#btn-redo-desktop::after, #btn-redo-log::after, #btn-redo-mobile-new::after, #btn-redo-egg::after,
.btn-reset-text::after, .tree-reset-btn::after, .tn-action-btn.reset-neutral::after,
button[onclick="clearPlan()"]::after, button[onclick="clearEggPlan()"]::after {
    content: "";
    position: absolute;
    top: 40%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 70%; 
    height: 70%;
    background-repeat: no-repeat;
    background-position: center;
    background-size: contain;
}

/* Adjust icons inside capsule */
.control-capsule button::after {
    width: 65% !important; 
    height: 65% !important;
}

#btn-undo-desktop::after, #btn-undo-log::after, #btn-undo-mobile-new::after, #btn-undo-egg::after { background-image: url('../icons/button_undo.png'); }
#btn-redo-desktop::after, #btn-redo-log::after, #btn-redo-mobile-new::after, #btn-redo-egg::after { background-image: url('../icons/button_redo.png'); }
.btn-reset-text::after, .tree-reset-btn::after, .tn-action-btn.reset-neutral::after, button[onclick="clearPlan()"]::after, button[onclick="clearEggPlan()"]::after { background-image: url('../icons/button_reset.png'); }

/* COLORS */
#btn-undo-desktop:not(:disabled), #btn-redo-desktop:not(:disabled), #btn-undo-log:not(:disabled), #btn-redo-log:not(:disabled), #btn-undo-mobile-new:not(:disabled), #btn-redo-mobile-new:not(:disabled), #btn-undo-egg:not(:disabled), #btn-redo-egg:not(:disabled) { background-color: #00b0ff !important; box-shadow: inset 0 -6px 0 0 #005680, 0 4px 5px rgba(0,0,0,0.2) !important; }
#btn-undo-desktop:disabled, #btn-redo-desktop:disabled, #btn-undo-log:disabled, #btn-redo-log:disabled, #btn-undo-mobile-new:disabled, #btn-redo-mobile-new:disabled, #btn-undo-egg:disabled, #btn-redo-egg:disabled { background-color: #dcdcdc !important; cursor: default; box-shadow: inset 0 -6px 0 0 #7f8c8d !important; transform: none !important; }
#btn-undo-desktop:disabled::after, #btn-redo-desktop:disabled::after, #btn-undo-log:disabled::after, #btn-redo-log:disabled::after, #btn-undo-mobile-new:disabled::after, #btn-redo-mobile-new:disabled::after, #btn-undo-egg:disabled::after, #btn-redo-egg:disabled::after { opacity: 0.3 !important; filter: grayscale(100%) !important; }
.btn-reset-text, .tree-reset-btn, .tn-action-btn.reset-neutral, button[onclick="clearPlan()"], button[onclick="clearEggPlan()"] { background-color: #ff4757 !important; box-shadow: inset 0 -6px 0 0 #c0392b, 0 4px 5px rgba(0,0,0,0.2) !important; }
#btn-undo-desktop:not(:disabled):active, #btn-redo-desktop:not(:disabled):active, .btn-reset-text:active, .tree-reset-btn:active, .tn-action-btn.reset-neutral:active, button[onclick="clearPlan()"]:active, button[onclick="clearEggPlan()"]:active { transform: translateY(3px); box-shadow: inset 0 -2px 0 0 rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2) !important; }
#btn-undo-desktop:not(:disabled):active::after, #btn-redo-desktop:not(:disabled):active::after, .btn-reset-text:active::after, .tree-reset-btn:active::after, .tn-action-btn.reset-neutral:active::after, button[onclick="clearPlan()"]:active::after, button[onclick="clearEggPlan()"]:active::after { transform: translate(-50%, -40%); }

/* TREE SELECTOR BUTTONS */
.tree-seg-btn { flex: 1; height: 100%; position: relative; background: transparent; border: none; border-right: 1.5px solid #000000; margin: 0; cursor: pointer; color: #ffffff; font-family: 'Fredoka One', 'Fredoka', sans-serif; font-size: 0.9rem; -webkit-text-stroke: 2px #000000; paint-order: stroke fill; display: flex; align-items: center; justify-content: center; gap: 8px; z-index: 1; transition: transform 0.1s ease; }
.tree-seg-btn:last-child { border-right: none; }
/* === FIX: REMOVED SHADOW FROM TREE BUTTON IMAGES === */
.tree-seg-btn img { 
    height: 24px; 
    width: auto; 
    filter: none !important; 
    box-shadow: none !important; 
}
.tree-seg-btn.active { z-index: 50; border-right-color: transparent; }
.tree-seg-btn.active::before { content: ""; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 110%; height: 120%; border: 2px solid #000000; border-radius: 8px; box-shadow: none !important; z-index: -1; }
.tree-seg-btn.forge.active::before { background-color: #5eff8b; }
.tree-seg-btn.spt.active::before { background-color: #fcfe5d; }
.tree-seg-btn.power.active::before { background-color: #e17373; }

/* Force Uppercase for Nav Buttons */
#btn-plan, #btn-plan-mobile-new, 
#btn-setup, #btn-setup-mobile-new {
    text-transform: uppercase !important;
}


/* ==========================================================================
   SECTION 6: TREE CANVAS & NODES
   ========================================================================== */

.tree-container { 
    flex: 1; 
    overflow-y: auto !important; 
    position: relative; 
    display: block !important; 
    padding: 0px 20px 20px 20px; 
    background: transparent; 
    z-index: 5; 
}

.tree-canvas { 
    position: relative; 
    width: 100%; 
    max-width: 800px; 
    min-width: 320px; 
    margin: 0 auto; 
    padding-top: 5px; 
    padding-bottom: 0px !important; 
    display: block; 
    opacity: 1 !important; 
    visibility: visible !important; 
}

/* --- HOVER TOOLTIP FOR NODES --- */
.node::before {
    content: attr(data-name); /* Pulls the text from the data-name attribute */
    position: absolute;
    bottom: 110%; /* Positions it just above the node */
    left: 50%;
    transform: translateX(-50%);
    
    /* Styling to match your theme */
    background-color: #ffffff;
    color: #000000;
    font-family: 'Fredoka', sans-serif;
    font-size: 0.8rem;
    padding: 6px 12px;
    border: 2px solid #000000;
    border-radius: 8px;
    white-space: nowrap;
    
    /* Font outlining */
    -webkit-text-stroke: 0px #000000;
    paint-order: stroke fill;

    
    /* Hidden by default */
    opacity: 0;
    visibility: hidden;
    pointer-events: none; /* Prevents the tooltip from blocking mouse clicks */
    z-index: 100;
    
    /* Smooth slide-up animation */
    transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s;
}

/* Reveal and animate the tooltip on hover */
.node:hover::before {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(-5px); /* Slides up slightly */
}
/* NODE STYLES */
.node { width: 50px; height: 50px; background-color: #dcdcdc; border: 3px solid #7f8c8d; border-radius: 50%; position: relative; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; transition: transform 0.1s, border-color 0.2s, background-color 0.2s; -webkit-backface-visibility: hidden; backface-visibility: hidden; transform: translateZ(0); }
.node:hover { transform: scale(1.15); z-index: 20; }
.node .node-img { width: 80%; height: 80%; object-fit: contain; pointer-events: none; z-index: 5; filter: grayscale(100%); opacity: 0.5; transition: filter 0.2s, opacity 0.2s; }
.node.unlocked { background-color: #ffffff; border-color: #2d3436; }
.node.unlocked .node-img { filter: none; opacity: 1; }
.tree-forge .node.active-setup, .tree-forge .node.active-plan { background-color: #5eff8b; border-color: #000000;}
.tree-spt .node.active-setup, .tree-spt .node.active-plan { background-color: #fcfe5d; border-color: #000000;}
.tree-power .node.active-setup, .tree-power .node.active-plan { background-color: #e17373; border-color: #000000;}
.node-level { position: absolute; bottom: -22px; left: 50%; transform: translateX(-50%); color: #fff; font-family: 'Fredoka', cursive !important; font-size: 0.9rem !important; font-weight: 650 !important;-webkit-text-stroke: 3px #000; paint-order: stroke fill; white-space: nowrap; z-index: 10; pointer-events: none; }
.node-tier-badge { display: flex; align-items: center; justify-content: center; position: absolute; top: -8px; left: -8px; width: 20px; height: 20px; background: #ebebeb; border: 2px solid #000000; border-radius: 50%; color: #ffffff; -webkit-text-stroke: 2.5px #000000; paint-order: stroke fill; font-size: 10px; font-weight: 900; font-family: sans-serif; z-index: 15; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
.node:not(.unlocked) .node-tier-badge { background: #bdc3c7; border-color: #7f8c8d; }
.connections-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
.connector { fill: none; stroke-width: 4px; stroke: #2d3436; stroke-linecap: round; stroke-linejoin: round; }
.connector.locked { stroke: #bdc3c7 !important; opacity: 0.5; }

/* TIER BLOCK */
.tier-block { width: 100%; max-width: 100%; display: flex; flex-direction: column; align-items: center; margin-bottom: 60px; }


/* ==========================================================================
   SECTION 7: TIER HEADER & MAX BUTTON
   ========================================================================== */

/* 1. Ensure the Container is Visible and Aligned */
.tier-header {
    display: flex !important;   /* Fixes "gone" issue */
    align-items: center;
    justify-content: space-between;
    width: 100%;
    max-width: 600px;           /* matches tree width */
    margin: 30px auto 15px auto; 
    padding: 0 10px;
    position: relative;
    z-index: 5;
    box-sizing: border-box;     /* Prevents padding from breaking width */
}

/* 2. The Title Pill (TIER I) - Reference Style */
.tier-title {
    font-family: 'Fredoka One', 'Fredoka', sans-serif;
    font-size: 1.5rem;
    color: #ffffff !important;
    -webkit-text-stroke: 2px #000000;
    
    background-color: #ffffff;
    border: 3px solid #000000;
    border-radius: 12px;
    padding: 6px 24px;
    box-shadow: 0 4px 0 rgba(0,0,0,0.2);
    
    /* Center text vertically */
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
}

/* 3. The MAX Button */
.tier-max-btn {
    display: flex !important;   /* Fixes "gone" issue */
    align-items: center;
    justify-content: center;
    
    /* --- SIZE SETTINGS --- */
    height: 45px !important;       /* Change Height Here */
    width: 90px !important;        /* Change Width Here */
    
    /* --- FONT SETTINGS --- */
    font-family: 'Fredoka One', 'Fredoka', sans-serif !important;
    font-size: 1.0rem !important;  
    color: #ffffff !important;
    text-transform: uppercase !important;
    
    -webkit-text-stroke: 1.5px #000000; /* Black Outline */
    
    /* --- BOX STYLE --- */
    background-color: #02a2ff !important; /* Main Blue */

    /* The "Inset" 3D Shadow (Darker Blue) */
    box-shadow: inset 0 -5px 0 0 #005d96, 0 4px 5px rgba(0,0,0,0.2) !important;
    border: 2px solid #000000 !important; /* Thick Border */
    border-radius: 12px !important;
     padding: 0px 20px 5px 20px !important; 
    
    
    /* Reset Standard Button Styles */
    cursor: pointer;
    margin: 0 !important;
    min-height: 46px; /* Ensures same height visual as Tier I */
    
    /* Alignment (Do not change) */
    box-sizing: border-box !important;
    z-index: 2;
}

/* Click Animation for Max Button */
.tier-max-btn:active {
    transform: translateY(3px);
    box-shadow: inset 0 -2px 0 0 #005d96, 0 1px 2px rgba(0,0,0,0.2) !important;
}
.tier-max-btn:hover { background: #000; }

/* Hide MAX button when in PLAN mode */
body[data-mode="plan"] .tier-max-btn {    
    visibility: hidden !important;
    pointer-events: none !important; /* Ensures you can't click the invisible button */
}


/* ==========================================================================
   SECTION 8: CONFIG CARDS & CAPSULES
   ========================================================================== */
.config-card {
    background-color: #ecf0f1;
    border: 3px solid #000000;
    border-radius: 12px;
    padding: 10px;
    margin: 0 15px 15px 15px; /* Spacing from sides and bottom */
    display: flex;
    flex-direction: column;
    gap: 5px; /* Spacing between the two rows inside */
    background-clip: padding-box;
}

/* Remove the old margins from the inner rows so they fit nicely inside the card */
.config-card .war-setup-row,
.config-card .date-row-styled {
    margin: 0 !important;
    width: 100%;
    padding: 5px 0;
}

/* FLOATING BOTTOM CAPSULE */
.bottom-capsule {
    position: absolute;
    bottom: 0;
    left: 50%;
    /* Lifted slightly visually using transform to overlap border correctly */
    transform: translate(-50%, 50%); 
    z-index: 500;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
    margin-bottom: 3px; /* Matches the visual offset of the tree canvas buttons */
}

#capsule-logs, 
#capsule-egg {
    bottom: 4px !important; /* Lifts them up to match the left side visually */
}


/* ==========================================================================
   SECTION 9: MOBILE & FOOTER OVERRIDES
   ========================================================================== */
.bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: #ffffff; border-top: 1px solid #dfe6e9; z-index: 9000; justify-content: space-around; align-items: center; padding-bottom: env(safe-area-inset-bottom); }
.b-nav-item { background: transparent; border: none; color: #95a5a6; display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1; height: 100%; cursor: pointer; transition: color 0.2s; }
.b-nav-item.active { color: var(--accent-blue); background: #f0f8ff; }
.b-icon { font-size: 1.4em; margin-bottom: 2px; }
.b-label { font-size: 0.75em; font-weight: 600; margin-top: 2px; }
.more-menu { position: fixed; top: 0; left: 0; width: 100%; height: calc(100% - 60px); background: #ffffff; z-index: 100; overflow-y: auto; padding: 20px; box-sizing: border-box; display: none; }
.more-menu.show { display: block; }
.menu-section-title { color: #7f8c8d; font-size: 0.8em; font-weight: bold; margin: 20px 0 8px 5px; }
.menu-card { background: #f8f9fa; border-radius: 10px; overflow: hidden; border: 1px solid #eee; }
.menu-item { width: 100%; background: transparent; border: none; padding: 15px; display: flex; align-items: center; color: #2c3e50; font-size: 1em; cursor: pointer; text-align: left; }
.menu-item:active { background: #f1f1f1; }
.menu-icon { margin-right: 15px; font-size: 1.2em; width: 30px; text-align: center; }
.menu-divider { height: 1px; background: #eee; margin: 0 15px; }
.help-link, .help-link:visited { color: #7f8c8d !important; text-decoration: none; font-weight: bold; transition: 0.3s ease; }
.github-icon { height: 1.2em; opacity: 0.5; transition: 0.3s ease; filter: none; }
.help-link:hover { color: var(--accent-blue) !important; }
.help-link:hover .github-icon { opacity: 1; transform: scale(1.1); filter: none; }
@media (max-width: 768px) {
    .seg-btn { font-size: 0.7em; padding: 8px 0; letter-spacing: 0.5px; }
    .desktop-only { display: none !important; }
    #calc-date-mobile { display: none; margin-left: auto; gap: 5px; }
    #egg-date-mobile { display: none; gap: 5px; align-items: center; }
}
@keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

/* =========================================
   10. DASHBOARD MINIMIZE (FOCUS MODE)
   ========================================= */

/* Add smooth transitions to the dashboard for sliding */
.dashboard-pane {
    transition: width 0.3s ease, min-width 0.3s ease, max-width 0.3s ease, flex 0.3s ease, border-width 0.3s ease, margin 0.3s ease !important;
}

/* Fade out the contents of the dashboard smoothly */
.dashboard-pane > *:not(#dash-toggle-container) {
    transition: opacity 0.2s ease, transform 0.2s ease !important;
}

/* THE MINIMIZED STATE: Shrink to 0 and remove the grid gap */
.dashboard-pane.minimized {
    flex: 0 0 0px !important;
    width: 0px !important;
    min-width: 0px !important;
    max-width: 0px !important;
    border-width: 0px !important;
    padding: 0 !important;
    margin-right: -20px !important; /* Eats the workspace gap so the center pane slides flush */
}

/* Hide the inner content completely when minimized */
.dashboard-pane.minimized > *:not(#dash-toggle-container) {
    opacity: 0 !important;
    transform: translateX(-15px) !important;
    pointer-events: none !important;
}

/* --- THE INVISIBLE ANCHOR CONTAINER --- */
#dash-toggle-container {
    position: absolute;
    bottom: 0px !important; 
    left: 50%;
    transform: translate(-50%, 50%); /* Hangs half-off the bottom */
    z-index: 9999;
    pointer-events: none !important; /* Lets clicks pass through the invisible box */
}

/* Keeps the anchor safely on-screen when the dashboard shrinks */
.dashboard-pane.minimized #dash-toggle-container {
    transform: translate(-10px, 50%); 
}

/* --- THE RAW FLOATING BUTTON STYLING --- */
#btn-toggle-dash {
    pointer-events: auto !important; /* Makes the actual button clickable */
    
    /* =========================================
       ðŸ‘‰ CHANGE BUTTON SIZE HERE
       ========================================= */
    width: 38px !important;  
    height: 38px !important; 
    
    /* =========================================
       ðŸ‘‰ CHANGE BUTTON COLOR HERE 
       ========================================= */
    background-color: #00a3ff !important; /* Main Color (Currently Purple) */
    
    /* Standard border settings */
    border: 2px solid #000000 !important; 
    border-radius: 8px !important;
    
    /* =========================================
       ðŸ‘‰ CHANGE 3D SHADOW COLOR HERE 
       (Make the # hex code a slightly darker version of your main color)
       ========================================= */
    box-shadow: inset 0 -7px 0 0 #005d96, 0 2px 4px rgba(0,0,0,0.2) !important;
    
    /* Centers the icon */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.1s, box-shadow 0.1s;
    margin: 0 !important;
    padding: 0 !important;
}

/* The 'Pressed' Animation */
#btn-toggle-dash:active {
    transform: translateY(2px) !important;
    /* Uses the same dark shadow color as above, but shrinks it */
    box-shadow: inset 0 -2px 0 0 #005d96, 0 1px 2px rgba(0,0,0,0.2) !important; 
}

/* The Arrow Icon Styling */
#dash-toggle-icon {
    color: #ffffff;
    font-size: 16px;
    font-family: 'Fredoka One', cursive;
    -webkit-text-stroke: 2.5px #000000;
    paint-order: stroke fill;
    margin-top: -7px; 
    transition: transform 0.3s ease;
}

/* =========================================
   INTERACTIVE HOVER EFFECTS
   ========================================= */

/* 1. Main Dashboard Buttons (Save, Load, Help) */
.sys-btn:hover {
    transform: translateY(-2px) !important;
    /* Increase shadow to match the lift */
    box-shadow: inset 0 -6px 0 0 #70abc0, 0 6px 0 rgba(0,0,0,0.2) !important; 
    filter: brightness(1.1); /* Slight glow */
}

/* 2. Dashboard Tool List (Schedule, Stats, etc.) */
.tools-group-box .dash-btn:hover {
    transform: translateY(-2px) !important;
    background-color: #f9f9f9 !important; /* Very subtle grey tint */
    box-shadow: 0 6px 0 rgba(0,0,0,0.15) !important;
}

/* 3. Top Header Capsule Buttons (Undo/Redo) */
.control-capsule button:not(:disabled):hover {
    transform: translateY(-2px);
    filter: brightness(1.15);
    box-shadow: inset 0 -6px 0 0 rgba(0,0,0,0.2), 0 6px 0 rgba(0,0,0,0.2) !important;
}

/* 4. Tree Selector Tabs (Forge, SPT, Power) */
.tree-seg-btn:not(.active):hover {
    background-color: rgba(255, 255, 255, 0.1); /* Subtle highlight */
}

/* 5. Max Button */
.tier-max-btn:hover {
    transform: translateY(-2px);
    filter: brightness(1.1);
    box-shadow: inset 0 -5px 0 0 #005d96, 0 6px 0 rgba(0,0,0,0.2) !important;
}

/* Minimize / Expand Button Hover Effect */
#btn-toggle-dash:hover {
    transform: translateY(-3px) !important; /* Lifts up */
    filter: brightness(1.2) !important;     /* Brightens the purple/blue */
    
    /* 1. Keeps the 3D 'Inset' shadow at the bottom (-7px)
       2. Increases the outer drop shadow to make it look floating (0 6px 8px)
    */
    box-shadow: inset 0 -7px 0 0 #005d96, 0 6px 8px rgba(0,0,0,0.3) !important;
}